{"version":3,"sources":["webpack://nw-idolfest-website/./src/components/CenteredBox.js","webpack://nw-idolfest-website/./src/components/paymentForm.js","webpack://nw-idolfest-website/./src/pages/payment.js"],"names":["CenteredBoxStyle","styled","Box","textAlign","paddingBottom","children","appId","locationId","lambdaUrl","initializeCard","payments","card","attach","buildPaymentRequest","amount","paymentRequest","countryCode","currencyCode","total","toString","label","initializeGooglePay","googlePay","createPayment","token","guid","body","JSON","stringify","sourceId","fetch","method","headers","paymentResponse","ok","json","text","errorBody","Error","tokenize","paymentMethod","tokenResult","status","errorMessage","errors","displayPaymentResults","paymentResults","statusContainer","document","getElementById","receiptContainer","classList","remove","add","style","visibility","innerHTML","payment","receiptUrl","resetSource","allIframes","i","length","src","PaymentForm","componentDidMount","handlePaymentMethodSubmission","event","preventDefault","cardButton","disabled","console","debug","getElementsByTagName","error","message","window","Square","this","props","className","addEventListener","undefined","applePay","render","id","type","Component","location","useState","squareStatus","setSquareStatus","useEffect","Promise","resolve","reject","sqPaymentScript","createElement","crossorigin","onload","onerror","appendChild","then","catch","params","URLSearchParams","search","get","tax","badgeType","title","PageHeader","PageContent","suppressHydrationWarning","CenteredBox","toFixed","Link","to"],"mappings":"oKAKMA,GAAmBC,OAAOC,IAAPD,CAAY,CACjCE,UAAW,SACXC,cAAe,QAenB,IAZoB,SAAC,GAAkB,IAAhBC,EAAe,EAAfA,SACnB,OACM,gBAACL,EAAD,KACGK,K,oFCVTC,EACAC,EACAC,E,uHASAF,EAAQ,gCACRC,EAAa,gBACbC,EAAY,mE,SAsBDC,E,0EAAf,WAA8BC,GAA9B,uFACuBA,EAASC,OADhC,cACUA,EADV,gBAEUA,EAAKC,OAAO,mBAFtB,gCAIWD,GAJX,4C,sBAOA,SAASE,EAAoBH,EAAUI,GACnC,OAAOJ,EAASK,eAAe,CAC3BC,YAAa,KACbC,aAAc,MACdC,MAAO,CACHJ,QAASA,EAAS,KAAKK,WACvBC,MAAO,W,SAKJC,E,4EAAf,WAAmCX,EAAUI,GAA7C,gFACUC,EAAiBF,EAAoBH,EAAUI,GADzD,SAE4BJ,EAASY,UAAUP,GAF/C,cAEUO,EAFV,gBAGUA,EAAUV,OAAO,sBAH3B,gCAKWU,GALX,4C,+BAQeC,E,8EAAf,WAA6BC,EAAOC,EAAMX,GAA1C,kFACUY,EAAOC,KAAKC,UAAU,CACxBrB,aACAsB,SAAUL,EACVC,OACAX,WALR,SAQkCgB,MAAMtB,EAAW,CAC3CuB,OAAQ,OACRC,QAAS,CACL,eAAgB,oBAEpBN,SAbR,YAQUO,EARV,QAgBwBC,GAhBxB,yCAiBeD,EAAgBE,QAjB/B,uBAoB4BF,EAAgBG,OApB5C,aAoBUC,EApBV,OAqBU,IAAIC,MAAMD,GArBpB,6C,+BAwBeE,E,0EAAf,WAAwBC,GAAxB,yFAC8BA,EAAcD,WAD5C,UAE+B,QADrBE,EADV,QAEoBC,OAFpB,yCAGeD,EAAYjB,OAH3B,aAKYmB,EALZ,oCAK+DF,EAAYC,OAC/DD,EAAYG,SACZD,GAAY,gBAAoBhB,KAAKC,UACjCa,EAAYG,SAId,IAAIN,MAAMK,GAZxB,6C,sBAiBA,SAASE,EAAsBH,EAAQI,GACnC,IAAMC,EAAkBC,SAASC,eAC7B,4BAEEC,EAAmBF,SAASC,eAC9B,qBAEW,YAAXP,GACAK,EAAgBI,UAAUC,OAAO,cACjCL,EAAgBI,UAAUE,IAAI,cAC9BH,EAAiBI,MAAMC,WAAa,UACpCL,EAAiBI,MAAMC,WAAa,UACpCL,EAAiBM,UAAjB,8DAA2FV,EAAeW,QAAQC,WAAlH,6LAEAX,EAAgBI,UAAUC,OAAO,cACjCL,EAAgBI,UAAUE,IAAI,eAGlCN,EAAgBO,MAAMC,WAAa,UAGvC,SAASI,EAAYC,GACjB,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAWE,OAAQD,IACnCD,EAAWC,GAAGE,IAAM,G,IAIPC,E,sGACXC,kB,mCAAN,6BAsCmBC,EAtCnB,gHAsCI,WAA6CC,EAAO3B,GAApD,gFACI2B,EAAMC,iBADV,SAKQC,EAAWC,UAAW,EAL9B,SAM4B/B,EAASC,GANrC,cAMchB,EANd,gBAOqCD,EAAcC,EAAOC,EAAMX,GAPhE,OAQQ+B,EAAsB,UADhBC,EAPd,QAUQyB,QAAQC,MAAM,kBAAmB1B,GACjC,IACIa,EAAYX,SAASyB,qBAAqB,WAD9C,SAXR,kDAeQJ,EAAWC,UAAW,EACtBzB,EAAsB,WACtB0B,QAAQG,MAAM,KAAEC,SAjBxB,2DAtCJ,uBAsCmBT,EAtCnB,8CACSU,OAAOC,OADhB,sBAEc,IAAIvC,MAAM,qCAFxB,OAKQb,EAAOqD,KAAKC,MAAMtD,KAClBX,EAASgE,KAAKC,MAAMjE,OAN5B,SAUQJ,EAAWkE,OAAOC,OAAOnE,SAASJ,EAAOC,GAVjD,0DAYcwC,EAAkBC,SAASC,eAC7B,6BAEY+B,UAAY,sBAC5BjC,EAAgBO,MAAMC,WAAa,UAhB3C,sDAsBqB9C,EAAeC,GAtBpC,QAsBQC,EAtBR,iEAwBQ4D,QAAQG,MAAM,2BAAd,MAxBR,sDA8B0BrD,EAAoBX,EAAUI,GA9BxD,QA8BQQ,EA9BR,0DAgCQiD,QAAQG,MAAM,iCAAd,MAhCR,SA2DUL,EAAarB,SAASC,eAAe,gBAChCgC,iBAAiB,QAA5B,mCAAqC,WAAgBd,GAAhB,wEACjCA,EAAMC,iBAD2B,SAE3BF,EAA8BC,EAAOxD,GAFV,2CAArC,4DAMkBuE,IAAd5D,GACwB0B,SAASC,eAAe,qBAChCgC,iBAAiB,QAAjC,mCAA0C,WAAgBd,GAAhB,iFAChCD,EAA8BC,EAAO7C,GADL,2CAA1C,uDAKAwD,KAAKK,UACkBnC,SAASC,eAAe,oBAChCgC,iBAAiB,QAAhC,mCAAyC,WAAgBd,GAAhB,iFAC/BD,EAA8BC,EAAOW,KAAKK,UADX,gDAAzC,uDA3ER,0E,uDAkFAC,OAAA,WACI,OACI,2BACI,wBAAMC,GAAG,gBACT,uBAAKA,GAAG,sBACR,uBAAKA,GAAG,mBACR,0BAAQA,GAAG,cAAcC,KAAK,UAA9B,QAA6CR,KAAKC,MAAMjE,OAAS,MAEjE,uBAAKuE,GAAG,6BACR,uBAAKA,GAAG,wB,GA5FiBE,aC3EzC,EAhDoB,SAAC,GAAkB,IAAhBC,EAAe,EAAfA,SACrB,GAAwCC,cAAS,MAA1CC,EAAP,KAAqBC,EAArB,MACAC,gBAAU,WDSD,IAAIC,SAAQ,SAACC,EAASC,GACzB,IAAMC,EAAkBhD,SAASiD,cAAc,UAI3CD,EAAgBjC,IAAM,yCAE1BiC,EAAgBE,YAAc,YAC9BF,EAAgBG,OAAS,WACrBL,KAEJE,EAAgBI,QAAU,WACtBL,EAAO,kBAAkBC,EAAgBjC,MAE7Cf,SAASyB,qBAAqB,QAAQ,GAAG4B,YAAYL,MCrBtDM,MAAK,WACJX,EAAgB,cAEjBY,OAAM,kBAAMZ,EAAgB,cAC9B,IAEH,IAAMa,EAAS,IAAIC,gBAAgBjB,EAASkB,QACtCjF,EAAO+E,EAAOG,IAAI,QAClB7F,EAAS0F,EAAOG,IAAI,UACpBC,EAAMJ,EAAOG,IAAI,OACjBE,EAAYL,EAAOG,IAAI,cAI7B,OACE,gBAAC,IAAD,KACE,gBAAC,IAAD,CAAKG,MAAM,YAEX,gBAACC,EAAA,EAAD,CACED,MAAM,YAGR,gBAACE,EAAA,EAAD,CAAaC,0BAAwB,GACnC,gBAACC,EAAA,EAAD,KAEE,mDAA2BL,EAA3B,WACA,qCAAa/F,EAAS8F,GAAO,IAA7B,IAAoCA,EAAM,EAAI,mCAAWA,EAAM,KAAKO,QAAQ,GAA9B,QAA+C,OAG7E,UAAjBzB,GACD,qDACkB,YAAjBA,GACC,gBAAC1B,EAAD,CAAavC,KAAMA,EAAMX,OAAQA,IAEnC,gBAACoG,EAAA,EAAD,KACE,gEAAuC,gBAAC,EAAAE,KAAD,CAAMC,GAAG,YAAT,cAAvC,6BAAuG5F,EAAvG,KACA,2BACA","file":"component---src-pages-payment-js-136861374a6622ef6bc8.js","sourcesContent":["import * as React from \"react\"\nimport PropTypes from 'prop-types'\nimport { styled } from '@material-ui/styles'\nimport { Box } from '@material-ui/core'\n\nconst CenteredBoxStyle = styled(Box)({\n    textAlign: 'center',\n    paddingBottom: '1em'\n})\n\nconst CenteredBox = ({ children }) => {\n    return (\n          <CenteredBoxStyle>\n            {children}\n          </CenteredBoxStyle>\n    )\n}\n  \nCenteredBox.propTypes = {\n    children: PropTypes.node.isRequired,\n}\n\nexport default CenteredBox","import React, { Component } from \"react\"\nimport \"./paymentForm.css\"\n\nlet appId\nlet locationId\nlet lambdaUrl\n\nif (process.env.NODE_ENV === 'development') {\n    appId = 'sandbox-sq0idb-S1xs9NDkn4cJR2JcDOupiA'\n    // this is the dev NWIF main location\n    // there is a separate location for (At Event)\n    locationId = 'LWGKEFPEN4J9S'\n    lambdaUrl = 'https://9lr67gx861.execute-api.us-east-1.amazonaws.com/reg2'\n} else {\n    appId = 'sq0idp-OyXssltwNQblNk9NOxKJ4w'\n    locationId = 'L4RPAVMCK1MD7'\n    lambdaUrl = 'https://9lr67gx861.execute-api.us-east-1.amazonaws.com/reg2-prod'\n}\n\nexport const loadSquareSdk = () => {\n    return new Promise((resolve, reject) => {\n        const sqPaymentScript = document.createElement(\"script\")\n        if (process.env.NODE_ENV === 'development') {\n            sqPaymentScript.src = \"https://sandbox.web.squarecdn.com/v1/square.js\"\n        } else {\n            sqPaymentScript.src = \"https://web.squarecdn.com/v1/square.js\"\n        }\n        sqPaymentScript.crossorigin = \"anonymous\"\n        sqPaymentScript.onload = () => {\n            resolve()\n        }\n        sqPaymentScript.onerror = () => {\n            reject(`Failed to load ${sqPaymentScript.src}`)\n        }\n        document.getElementsByTagName(\"head\")[0].appendChild(sqPaymentScript)\n    })\n}\n\nasync function initializeCard(payments) {\n    const card = await payments.card();\n    await card.attach('#card-container');\n\n    return card;\n}\n\nfunction buildPaymentRequest(payments, amount) {\n    return payments.paymentRequest({\n        countryCode: 'US',\n        currencyCode: 'USD',\n        total: {\n            amount: (amount / 100).toString(),\n            label: 'Total',\n        },\n    });\n}\n\nasync function initializeGooglePay(payments, amount) {\n    const paymentRequest = buildPaymentRequest(payments, amount);\n    const googlePay = await payments.googlePay(paymentRequest);\n    await googlePay.attach('#google-pay-button');\n\n    return googlePay;\n}\n\nasync function createPayment(token, guid, amount) {\n    const body = JSON.stringify({\n        locationId,\n        sourceId: token,\n        guid,\n        amount\n    });\n\n    const paymentResponse = await fetch(lambdaUrl, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n        },\n        body,\n    });\n\n    if (paymentResponse.ok) {\n        return paymentResponse.json();\n    }\n\n    const errorBody = await paymentResponse.text();\n    throw new Error(errorBody);\n}\n\nasync function tokenize(paymentMethod) {\n    const tokenResult = await paymentMethod.tokenize();\n    if (tokenResult.status === 'OK') {\n        return tokenResult.token;\n    } else {\n        let errorMessage = `Tokenization failed with status: ${tokenResult.status}`;\n        if (tokenResult.errors) {\n            errorMessage += ` and errors: ${JSON.stringify(\n                tokenResult.errors\n            )}`;\n        }\n\n        throw new Error(errorMessage);\n    }\n}\n\n// status is either SUCCESS or FAILURE;\nfunction displayPaymentResults(status, paymentResults) {\n    const statusContainer = document.getElementById(\n        'payment-status-container'\n    );\n    const receiptContainer = document.getElementById(\n        'receipt-container'\n    );\n    if (status === 'SUCCESS') {\n        statusContainer.classList.remove('is-failure');\n        statusContainer.classList.add('is-success');\n        receiptContainer.style.visibility = 'visible';\n        receiptContainer.style.visibility = 'visible';\n        receiptContainer.innerHTML = `Thank you for purchasing a NWIF badge! Please save <a href=${paymentResults.payment.receiptUrl} target=\"_blank\">your receipt</a> before closing this page.<br /><br /><a href=\"https://discord.gg/h5yJbXgTgE\" target=\"_blank\">Join our Discord</a> and claim your role now!<br /><br />`;\n    } else {\n        statusContainer.classList.remove('is-success');\n        statusContainer.classList.add('is-failure');\n    }\n\n    statusContainer.style.visibility = 'visible';\n}\n\nfunction resetSource(allIframes) {\n    for (let i = 0; i < allIframes.length; i++) {\n        allIframes[i].src = \"\"\n    }\n}\n\nexport default class PaymentForm extends Component {\n    async componentDidMount() {\n        if (!window.Square) {\n            throw new Error('Square.js failed to load properly');\n        }\n\n        let guid = this.props.guid\n        let amount = this.props.amount\n\n        let payments;\n        try {\n            payments = window.Square.payments(appId, locationId)\n        } catch {\n            const statusContainer = document.getElementById(\n                'payment-status-container'\n            );\n            statusContainer.className = 'missing-credentials';\n            statusContainer.style.visibility = 'visible';\n            return;\n        }\n\n        let card;\n        try {\n            card = await initializeCard(payments);\n        } catch (e) {\n            console.error('Initializing Card failed', e);\n            return;\n        }\n\n        let googlePay;\n        try {\n            googlePay = await initializeGooglePay(payments, amount);\n        } catch (e) {\n            console.error('Initializing Google Pay failed', e);\n            // There are a number of reason why Google Pay may not be supported\n            // (e.g. Browser Support, Device Support, Account). Therefore you should handle\n            // initialization failures, while still loading other applicable payment methods.\n        }\n\n        async function handlePaymentMethodSubmission(event, paymentMethod) {\n            event.preventDefault();\n\n            try {\n                // disable the submit button as we await tokenization and make a payment request.\n                cardButton.disabled = true;\n                const token = await tokenize(paymentMethod);\n                const paymentResults = await createPayment(token, guid, amount);\n                displayPaymentResults('SUCCESS', paymentResults);\n\n                console.debug('Payment Success', paymentResults);\n                try {\n                    resetSource(document.getElementsByTagName(\"iframe\"))\n                } finally { }\n            } catch (e) {\n                cardButton.disabled = false;\n                displayPaymentResults('FAILURE');\n                console.error(e.message);\n            }\n        }\n\n        const cardButton = document.getElementById('card-button');\n        cardButton.addEventListener('click', async function (event) {\n            event.preventDefault()\n            await handlePaymentMethodSubmission(event, card);\n        });\n\n        // Checkpoint 2.\n        if (googlePay !== undefined) {\n            const googlePayButton = document.getElementById('google-pay-button');\n            googlePayButton.addEventListener('click', async function (event) {\n                await handlePaymentMethodSubmission(event, googlePay);\n            });\n        }\n\n        if (this.applePay) {\n            const applePayButton = document.getElementById('apple-pay-button');\n            applePayButton.addEventListener('click', async function (event) {\n                await handlePaymentMethodSubmission(event, this.applePay);\n            });\n        }\n    }\n\n    \n    render() {\n        return (\n            <div>\n                <form id=\"payment-form\">\n                <div id=\"google-pay-button\"></div>\n                <div id=\"card-container\"></div>\n                <button id=\"card-button\" type=\"button\">Pay ${this.props.amount / 100}</button>\n                </form>\n                <div id=\"payment-status-container\"></div>\n                <div id=\"receipt-container\"></div>\n            </div>\n        )\n    }\n} ","import React, { useEffect, useState } from \"react\"\nimport { Link } from 'gatsby'\nimport Layout from '@components/layout'\nimport Seo from '@components/seo'\nimport PageContent from '@components/PageContent'\nimport PageHeader from '@components/PageHeader'\nimport CenteredBox from '@components/CenteredBox'\nimport PaymentForm, { loadSquareSdk } from '@components/paymentForm'\n\nconst PaymentPage = ({ location }) => {\n  const [squareStatus, setSquareStatus] = useState(null)\n  useEffect(() => {\n    loadSquareSdk()\n      .then(() => {\n        setSquareStatus(\"SUCCESS\")\n      })\n      .catch(() => setSquareStatus(\"ERROR\"))\n  }, []) // on mount, add the js script dynamically\n\n  const params = new URLSearchParams(location.search)\n  const guid = params.get('guid')\n  const amount = params.get('amount')\n  const tax = params.get('tax')\n  const badgeType = params.get('badge_type')\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams/get\n\n  return (\n    <Layout>\n      <Seo title=\"Payment\" />\n      \n      <PageHeader \n        title=\"Payment\" \n      />\n\n      <PageContent suppressHydrationWarning>\n        <CenteredBox>\n          \n          <p>Finish purchasing your {badgeType} below.</p>\n          <p>Total: ${(amount - tax) / 100} { tax > 0 ? <span>+ ${(tax / 100).toFixed(2)} tax</span> : null}</p>\n        </CenteredBox>\n\n        {squareStatus === \"ERROR\" &&\n        \"Failed to load SquareSDK. Please refresh the page.\"}\n        {squareStatus === \"SUCCESS\" && (\n          <PaymentForm guid={guid} amount={amount} />\n        )}\n        <CenteredBox>\n          <small>If you encounter errors, please <Link to='/contact'>contact us</Link> and provide reference ID {guid}.</small>\n          <br />\n          <small>Payment processing is provided by Square. NWIF never handles or stores your credit card details.</small>\n        </CenteredBox>\n      </PageContent>\n    </Layout>\n  )\n}\n\nexport default PaymentPage\n"],"sourceRoot":""}